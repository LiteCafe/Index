name: Push 2 Depoly Branch

#Source: ZhuMeng & MTSMC

#Mod :Yurik

on:
    push:
        branches:
            - main
    #æ‰‹åŠ¨è§¦å‘
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            # è·å–æºç 
            - name: è¿å‡ºä»£ç 
              # ä½¿ç”¨actionåº“  actions/checkoutè·å–æºç 
              uses: actions/checkout@master

            - name: è·å–æäº¤ç‰ˆæœ¬å·
              id: get_version
              run: |
                  version=$(git rev-parse --short HEAD)
                  echo "VERSION=$version" >> $GITHUB_ENV
                  echo "Latest commit version: $version"

            - name: æŸ¥è¯¢æ‰€æœ‰ HTML æ–‡ä»¶
              run: |
                  find . -type f -name "*.html" > html_files.txt
                  cat html_files.txt # è¾“å‡ºæŸ¥æ‰¾åˆ°çš„ HTML æ–‡ä»¶åˆ—è¡¨

            - name: æ›´æ–° HTML ä¸­çš„ç‰ˆæœ¬å·
              run: |
                  version=${{ env.VERSION }}
                  while IFS= read -r file; do
                    sed -i "s/{{VERSION}}/$version/g" "$file"
                    echo "Updated version in $file"
                  done < html_files.txt

            - name: è¾“å‡ºä¿®æ”¹åçš„ HTML æ–‡ä»¶åˆ—è¡¨
              run: |
                  cat html_files.txt # è¾“å‡ºä¿®æ”¹åçš„ HTML æ–‡ä»¶åˆ—è¡¨

            - name: Deploy ğŸš€ # éƒ¨ç½²
              uses: JamesIves/github-pages-deploy-action@v4.3.3
              with:
                  branch: Deploy # éƒ¨ç½²åæäº¤åˆ°çš„åˆ†æ”¯
                  folder: . # è¿™é‡Œå¡«æ‰“åŒ…å¥½çš„ç›®å½•åç§°

